#:schema node_modules/wrangler/config-schema.json
name = "dundun-sentinel"
main = "src/index.js"
compatibility_date = "2024-12-08"
compatibility_flags = [ "nodejs_compat" ]

# Workers Assets - 静态资源配置
[assets]
directory = "./frontend/dist"
binding = "ASSETS"
# SPA 模式：所有非匹配路由返回 index.html
html_handling = "auto-trailing-slash"
not_found_handling = "single-page-application"

# D1 数据库绑定（主要数据存储）
# 首次部署请在 Cloudflare 控制面板创建 D1 数据库，然后将 ID 添加到 GitHub Secrets
[[d1_databases]]
binding = "DB"
database_name = "dundun-sentinel-db"
database_id = "YOUR_D1_DATABASE_ID"

# 定时任务
[triggers]
crons = [
  "* * * * *",    # 每分钟：站点检测（轮流模式）
  "0 * * * *"     # 每小时整点：历史数据清理（独立 CPU 配额）
]

# 本地开发配置
[vars]
ENVIRONMENT = "development"

# 可观察性配置
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1
